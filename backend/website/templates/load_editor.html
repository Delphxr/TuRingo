<!DOCTYPE html>
<html>
<head>
    <title>Turingo</title>
</head>
<body>
    <!-- Se despliega el contenido cargado del editor -->
    {{ webpage_content | safe }}
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>

<script>
    function captureWebpage() {
        var webpageName = "Turingo";
        var captured_webpage = document.documentElement.outerHTML;
        var id_tarea = getUrlParameter('id_tarea');

        var formData = new FormData();
        formData.append('webpage_name', webpageName);
        formData.append('captured_webpage', captured_webpage);
        formData.append('id_tarea', id_tarea);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/save_webpage');
        xhr.onload = function() {
            if (xhr.status === 200) {
                console.log(xhr.response.message);
            } else {
                console.error('Error al guardar webpage');
            }
        };
        xhr.send(formData);
    }

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    function loadWebpage() {
        var flaskViewURL = "{{ url_for('views.load_webpage') }}";
        window.location.href = flaskViewURL+"?id_tarea="+getUrlParameter("id_tarea");
    }

    // Attach an event listener to the load button
    document.getElementById('load-button').addEventListener('click', function() {
        loadWebpage();
    });

    document.getElementById('save-button').addEventListener('click', function() {
        captureWebpage();
    });
</script>

<script>
    loadCode();
</script>

</html>